function drawWavesStratified(W, H, pal, rand, tone = 'dark'){
  ctx.save();
  ctx.globalCompositeOperation = 'source-over';

  // Background gradient
  const bg = ctx.createLinearGradient(0, 0, 0, H);
  bg.addColorStop(0, shade(pal[0], tone === 'light' ? +0.18 : +0.06));
  bg.addColorStop(1, shade(pal[pal.length - 1], tone === 'light' ? -0.08 : -0.28));
  ctx.fillStyle = bg;
  ctx.fillRect(0, 0, W, H);

  const fn = makeWaveFn(rand);
  const layers = Math.max(6, pal.length + 2);
  const topPad = H * 0.05;
  const spacing = (H - topPad) / layers;
  const margin = 60;                 // bleed left/right
  const bottomBleed = Math.max(80, H * 0.12);
  const steps = Math.max(320, Math.floor(W / 6));

  let y = topPad;
  for (let i = 0; i < layers; i++){
    const color = pal[Math.min(i, pal.length - 1)];
    const amp = spacing * (0.45 + 0.25 * rand());

    ctx.beginPath();
    ctx.moveTo(-margin, y + amp * fn(0));
    for (let s = 1; s <= steps; s++){
      const t = s / steps, x = t * W;
      ctx.lineTo(x, y + amp * fn(t));
    }

    // Important: send polygon down past the bottom before closing
    ctx.lineTo(W + margin, H + bottomBleed);
    ctx.lineTo(-margin, H + bottomBleed);
    ctx.closePath();

    ctx.fillStyle = color;
    ctx.fill();

    y += spacing;
  }

  // Safety footer fill to ensure no background sliver shows
  ctx.fillStyle = shade(pal[pal.length - 1], tone === 'light' ? -0.05 : -0.35);
  ctx.fillRect(0, H - bottomBleed, W, bottomBleed);

  ctx.restore();
}
